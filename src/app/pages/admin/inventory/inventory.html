<div class="disenoAdmin">

  <main class="contenidoAdmin">
    <div class="filaEncabezadoContenido">
      <h1>Gesti√≥n de Insumos</h1>
      <button class="btnPrimario" (click)="abrirModal()">+ Agregar Insumo</button>
    </div>

    <div class="tarjetaInventario">
      <table>
        <thead>
          <tr>
            <th>Insumo</th>
            <th>Tipo</th>
            <th>Stock</th>
            <th>Caducidad</th> 
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of inventoryItems">
            <td>
              <div class="infoItem">
                <strong>{{ item.name }}</strong>
                <small>Lote: {{ item.batch }}</small>
              </div>
            </td>
            <td>{{ item.type }}</td>
            <td>{{ item.stock }} {{ item.unit }}</td>
            <td>{{ item.expiryDate }}</td>
            <td>
              <span class="etiquetaEstado" 
                [class.peligro]="isExpired(item.expiryDate)" 
                [class.advertencia]="isNearExpiry(item.expiryDate)"
                [class.exito]="!isNearExpiry(item.expiryDate) && !isExpired(item.expiryDate)">
                {{ getStatus(item.expiryDate) }}
              </span>
            </td>
            <td>
              <button class="btnIcono" title="Entrada" (click)="actualizarStock(item, 1)">+</button>
              <button class="btnIcono" title="Salida" (click)="actualizarStock(item, -1)">-</button>
              <button class="btnIcono eliminar" (click)="eliminarItem(item.id)"><i class="bi bi-trash"></i></button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </main>

  <div class="superposicionModal" *ngIf="mostrarModal">
    <div class="tarjetaModal">
      <div class="encabezadoModal">
        <h3>Nuevo Material</h3>
        <button class="btnCerrar" (click)="cerrarModal()"><i class="fa-solid fa-xmark"></i></button>
      </div>
      
      <form (submit)="agregarItem()">
        <div class="grupoFormulario">
          <label>Nombre del Insumo</label>
          <input type="text" [(ngModel)]="nuevoItem.name" name="name" required placeholder="Ej. Resina Flexible">
        </div>

        <div class="filaFormulario">
          <div class="grupoFormulario mitad">
            <label>Tipo</label>
            <select [(ngModel)]="nuevoItem.type" name="type">
              <option value="Resina">Resina</option>
              <option value="Limpieza">Limpieza</option>
              <option value="EPP">EPP</option>
              <option value="Herramienta">Herramienta</option>
            </select>
          </div>
          <div class="grupoFormulario mitad">
            <label>Lote</label>
            <input type="text" [(ngModel)]="nuevoItem.batch" name="batch" placeholder="Ej. L-99">
          </div>
        </div>

        <div class="filaFormulario">
          <div class="grupoFormulario mitad">
            <label>Stock Inicial</label>
            <input type="number" [(ngModel)]="nuevoItem.stock" name="stock" required min="0">
          </div>
          <div class="grupoFormulario mitad">
            <label>Unidad</label>
            <select [(ngModel)]="nuevoItem.unit" name="unit">
              <option value="ml">ml</option>
              <option value="L">Litros</option>
              <option value="pzas">Piezas</option>
              <option value="kg">Kg</option>
            </select>
          </div>
        </div>

        <div class="grupoFormulario">
          <label>Caducidad</label>
          <input type="date" [(ngModel)]="nuevoItem.expiryDate" name="expiryDate" required>
        </div>

        <button type="submit" class="btnPrimario anchoTotal">Registrar</button>
      </form>
    </div>
  </div>

</div>